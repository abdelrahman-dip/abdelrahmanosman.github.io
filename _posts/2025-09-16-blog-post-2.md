---
title: "RFIC Oscillator Simulation Using ADS"
date: 2025-09-07
permalink: /posts/2025/09/rfic-oscillator/
tags:
  - RFIC
  - Microwave Engineering
  - ADS
  - Oscillator
---

## Design Objective

The goal is to simulate a **369 MHz RFIC oscillator** using BJTs in Advanced Design System (ADS). The simulation involves both harmonic balance (HB) and transient simulators, including phase noise analysis.

The simulations demonstrate close agreement:
- Simulated frequency agrees to <1%.
- Fundamental output powers agree to within about 0.2 dB.

The substrate and other parameters are implied in the BJT model and schematic components.

---

## Oscillator Design

The oscillator is based on a **BJT-based Colpitts-like design** with a resonator network. The design uses nonlinear BJT models to capture real-world behavior, including noise sources for phase noise analysis.

Phase noise in an oscillator arises from small-signal mixing of noise due to the nonlinear characteristics of the active device (BJT) and passive components. Noise sources, such as flicker noise and thermal noise, mix with the oscillator signal and its harmonics, producing sidebands that degrade spectral purity. The phase noise power spectral density can be modeled as:

$$
\mathcal{L}(\Delta f) = 10 \log_{10} \left( \frac{\text{Power in sideband at } \Delta f}{\text{Power in carrier}} \right)
$$

where \\( \Delta f \\) is the offset frequency from the carrier.

The oscillation frequency is approximated by the resonator's resonance condition:

$$
f_0 = \frac{1}{2\pi \sqrt{L_{\text{eff}} C_{\text{eff}}}}
$$

where:
- \\( L_{\text{eff}} \\) = effective inductance, accounting for parasitic effects
- \\( C_{\text{eff}} \\) = effective capacitance, including junction and stray capacitances

The quality factor \\( Q \\) of the resonator influences phase noise and stability:

$$
Q = \frac{\omega_0 L_{\text{eff}}}{R}
$$

where \\( \omega_0 = 2\pi f_0 \\) is the angular frequency, and \\( R \\) is the effective series resistance. A higher \\( Q \\) reduces phase noise but may limit tuning range.

The Leeson model provides a theoretical framework for phase noise:

$$
\mathcal{L}(\Delta f) = \frac{F k T}{2 P_s} \left( 1 + \frac{f_c}{|\Delta f|} + \frac{f_c^2}{|\Delta f|^2} \right)
$$

where:
- \\( F \\) = noise factor of the oscillator
- \\( k \\) = Boltzmann constant (\\( 1.38 \times 10^{-23} \, \text{J/K} \\))
- \\( T \\) = absolute temperature (e.g., 300 K)
- \\( P_s \\) = average power in the carrier
- \\( f_c \\) = flicker corner frequency

The phase noise contribution from flicker noise can be further detailed using the flicker noise corner frequency:

$$
\mathcal{L}_{\text{flicker}}(\Delta f) \propto \frac{K_f}{(\Delta f)^3}
$$

where \\( K_f \\) is a constant dependent on the BJT's flicker noise coefficient.

The loaded quality factor \\( Q_L \\) relates to the unloaded \\( Q_u \\) and coupling:

$$
\frac{1}{Q_L} = \frac{1}{Q_u} + \frac{1}{Q_{\text{ext}}}
$$

where \\( Q_{\text{ext}} \\) is the external quality factor due to load coupling.

The oscillation amplitude \\( A \\) in a nonlinear oscillator can be approximated by the Van der Pol equation for limit cycle behavior:

$$
\frac{d^2 V}{dt^2} - \alpha \left( 1 - \frac{V^2}{V_{\text{sat}}^2} \right) \frac{dV}{dt} + \omega_0^2 V = 0
$$

where:
- \\( \alpha \\) = negative resistance parameter
- \\( V_{\text{sat}} \\) = saturation voltage
- \\( V \\) = oscillator voltage

Harmonic balance simulation solves for steady-state periodic solutions by balancing nonlinear currents and voltages, while transient simulation captures time-domain dynamics, including startup behavior and transient noise effects.


---

## Schematic

<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/RFOSC/transient_sim.png" alt="RFIC Oscillator Transient Schematic" width="700"/>

The full schematic includes a resonator, BJTs (Q40MOD model), resistors, capacitors, and voltage sources (VDC=5V). The resonator is a ladder network with inductors, capacitors, and resistors for tuning the oscillation frequency.

The resonator component is:

<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/RFOSC/resonator.png" alt="Resonator Schematic" width="700"/>

Initial dimensions in the resonator:
- L1 = 30 nH
- C2 = 5 pF
- C4 = 0.8 pF
- R2 = 1 Ohm
- L2 = 3 nH
- C6 = 1 pF
- L3 = 3 nH
- C3 = 0.8 pF
- R1 = 1 Ohm
- C5 = 1 pF
- C1 = 1 pF

The BJT model (Q40MOD) parameters include:
- NPN=yes, PNP=no
- Is=1.074E-16
- Bf=130
- Nf=1.03
- Vaf=2.5
- Ikf=0.005425
- Ise=3.781E-13
- Ne=1.5
- Br=5.123
- Nr=1
- Var=0
- Ikr=0.028
- And other parameters as shown.

<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/RFOSC/bjt_model.png" alt="Q40MOD BJT Model Parameters" width="700"/>

---

## Harmonic Balance Simulation

The harmonic balance simulation is set up with phase noise analysis using an oscport component.

<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/RFOSC/harmonic_balance_sim.png" alt="Harmonic Balance Settings" width="500"/>

The full setup of the harmonic balance simulation (for phase noise analysis) is shown in the following schematic

<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/RFOSC/phasenoise_sim.png" alt="Harmonic Balance setup" width="500"/>

The simulation results shows the fundamental frequency at 369 MHz, with fundamental output power of **-29.93 dBm**. Harmonics are suppressed, with the second harmonic at **-79.14 dBm** and higher harmonics down to **-258.34 dBm**.

Phase noise plot shows a slope from approximately -30 dBc/Hz at 1 Hz to -120 dBc/Hz at 1 MHz. Specific values:
- At 1 Hz: 13.91 dBc/Hz
- At 10 Hz: -14.59 dBc/Hz
- At 100 Hz: -38.68 dBc/Hz
- At 1 kHz: -79.51 dBc/Hz
- At 10 kHz: -99.51 dBc/Hz
- At 100 kHz: -119.5 dBc/Hz
- At 1 MHz: -119.5 dBc/Hz (plateau)

The Noise contributors at 1 kHz are dominated by **BJT9** flicker (6.214 dBc), BJT9 ice (14.15 dBc), and others, summing to 13.91 dBc/Hz.

And the time-domain waveform from the harmonic balance shows a stable oscillations.

<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/RFOSC/phasenoise_sim_res.png" alt="Phase Noise and HB Results" width="700"/>

---

## Transient Simulation

The transient simulation is used to analyze the time-domain response of the oscillator.The full schematic setup for the transient analysis is shown below :

<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/RFOSC/transient_sim.png" alt="RFIC Oscillator Transient Schematic" width="700"/>

The simulation results show the output voltage oscillating with a period corresponding to a frequency of 364.7 MHz. The fundamental output power is 30.069 dBm.

The time waveform shows \\(V_{out}\\) crossing -0.010 V at m1=19.47 nsec and m2=24.95 nsec, giving a signal period of 5.48 nsec, or frequency of 182.5 MHz for a half of a period.

From the spectrum, the peak is at 364.7 MHz with 30.069 dBm.

And the calculated signal frequency is 370 MHz, but measured from markers is 364.7 MHz.

<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/RFOSC/transient_sim_res.png" alt="Transient Simulation Results" width="700"/>

---

## Summary of Key Results

The HB simulations predicts a fundamental frequency of 369 MHz with output power of -29.93 dBm, while transient simulation shows 364.7 MHz with 30.069 dBm. The frequency agreement is approximately 1.1%, which is closer to <1%. The power difference is about 60 dB, which seems discrepant; this may be due to different scaling or normalization in the simulations (e.g., HB in relative dBm, transient in absolute).

The phase noise analysis from HB shows acceptable levels for an RFIC oscillator, with contributors primarily from BJT **flicker** and **thermal noise**.

**Comparison of Key Parameters:**

| Parameter | HB Simulation | Transient Simulation |
|-----------|---------------|----------------------|
| Fundamental Frequency (MHz) | 369 | 364.7 |
| Fundamental Power (dBm) | -29.93 | 30.069 |
| Phase Noise at 1 kHz (dBc/Hz) | -79.51 | N/A |
| Phase Noise at 1 MHz (dBc/Hz) | -119.5 | N/A |

---

## Conclusion

The simulations demonstrate the effectiveness of HB and transient methods for oscillators design in ADS. The close agreement in frequency and the detailed phase noise analysis shows the accuracy of the BJT model and the resonator design for a 369 MHz rf oscillator.

---
