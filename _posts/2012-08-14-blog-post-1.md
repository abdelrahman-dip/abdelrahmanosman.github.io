---
title: "Low Noise Amplifier (LNA) Design Using ADS"
date: 2025-02-06
permalink: /posts/2025/09/lna-design/
tags:
  - RFIC
  - Microwave Engineering
  - ADS
  - Low Noise Amplifier
---

## Design Objective

The goal is to design a **Low Noise Amplifier (LNA)** with the following specifications:

- **Frequency range**: \\(  {1.4}{\text{GHz}} \\)–\\(  {1.8}{\text{GHz}} \\)
- **Gain**: \\( \geq  {12}{\text{dB}} \\)
- **Input/output return loss**: \\( \geq  {10}{\text{dB}} \\) (i.e., \\( S_{11} \\) and \\( S_{22} \leq  {-10}{\text{dB}} \\))
- **Noise figure**: \\( \leq  {2}{\text{dB}} \\)
- **Stability factor**: \\( K > 1 \\) across the band (unconditional stability)

The design process involved components selection, initial simulation, optimization, and final performance evaluation. The LNA was designed using **microstrip** technology with a **single-stage** topology, focusing on achieving a balance between low noise figure, high gain, and stability. This post details each step, including the challenges faced, such as initial poor output matching and high noise figure, and the optimization strategies employed to meet the specifications.


---

## Amplifier Design and Theory

The LNA is based on a **single-stage microstrip design**. The characteristic impedance of the microstrip line can be approximated by:

$$
Z_0 = \frac{87}{\sqrt{\epsilon_r + 1.41}} \ln\left(\frac{5.98h}{0.8w + t}\right)
$$

where:
- \\( h \\) = substrate height
- \\( w \\) = microstrip width
- \\( t \\) = copper thickness
- \\( \epsilon_r \\) = relative permittivity

The noise figure of the LNA is given by the Friis formula for a single-stage amplifier:

$$
F = F_{\text{min}} + \frac{R_n}{G_s} |\Gamma_s - \Gamma_{\text{opt}}|^2
$$

where:
- \\( F_{\text{min}} \\) = minimum noise figure
- \\( R_n \\) = equivalent noise resistance
- \\( G_s \\) = source conductance
- \\( \Gamma_s \\) = source reflection coefficient
- \\( \Gamma_{\text{opt}} \\) = optimum source reflection coefficient for minimum noise

The gain of the amplifier is approximated as:

$$
G = |S_{21}|^2 \frac{(1 - |\Gamma_s|^2)(1 - |\Gamma_L|^2)}{|1 - S_{11}\Gamma_s|^2 |1 - S_{22}\Gamma_L|^2}
$$

where:
- \\( \Gamma_s \\) = source reflection coefficient
- \\( \Gamma_L \\) = load reflection coefficient

---

## Schematic Design

<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/LNA/lna_schem.png" alt="LNA schematic" width="700"/>

The LNA was designed as a single-stage amplifier using microstrip lines for matching and biasing networks. The complete schematic, shown in Figure 1, includes the following components:

- **Input Matching Network:** Composed of microstrip lines (TL4, TL5) and a DC block capacitor (C1) to ensure proper impedance matching at the input while blocking DC signals. It was designed to minimize the noise figure by aligning the input impedance close to the optimum noise match (Γopt).  
- **Bias Network:** Includes a microstrip line (TL6) and an RF choke (MLEF) to provide the DC bias to the transistor while isolating the RF signal path, ensuring the transistor operates at the desired point for low noise and high gain.  
- **Output Matching Network:** Composed of microstrip lines (TL2, TL3) and a DC block capacitor (C2) to match the output impedance to 50 Ω, ensuring maximum power transfer and good return loss.  
- **Stabilization Components:** Initially not explicitly added (e.g., series resistors), but stability was addressed through optimization of the matching networks to achieve a stability factor K > 1.  

The schematic uses the ATF-54111 transistor, a GaAs pHEMT, selected for its low noise figure and high gain characteristics. The input and output ports are terminated with 50 Ω loads (Term1 and Term2), and the substrate is defined as "MSub1" with a thickness of 0.5 mm.


---

## Substrate Parameters

The microstrip design uses a substrate with the following parameters, which are typical for FR-4 but adjusted based on the schematic’s "MSub1" definition:

- **Relative Permittivity (εr):** 4.3  
- **Substrate Thickness (h):** 0.5 mm (from schematic)  
- **Loss Tangent (tanδ):** 0.02  
- **Copper Thickness (t):** 35 µm  

The characteristic impedance \\(Z_0\\) of the microstrip lines was calculated using the approximate formula for a microstrip line:

$$
Z_0 = \frac{87}{\sqrt{\varepsilon_r + 1.41}} \ln \left(\frac{5.98h}{0.8w + t}\right)
$$

where \\(w\\) is the width of the microstrip line. During optimization, the widths (w11 to w23) were tuned to achieve the desired impedance matching. For example, with \\(h = 0.5\text{ mm}\\), \\(\varepsilon_r = 4.3\\), and \\(t = 35 \mu\text{m}\\), a width \\(w \approx 1\text{ mm}\\) (typical for optimized values like w11 = 2.8233 mm) yields a Z0 close to 50 Ω, which is ideal for matching to the 50 Ω terminations.  

The loss tangent (tanδ = 0.02) indicates moderate substrate losses, which contribute to the overall noise figure and gain flatness.


---

## Initial Simulation

The initial performance of the LNA, before any optimization, is shown in Figure 2. The plots include S21
(gain), S11 (input return loss), S22 (output return loss), and SP STBFACT (stability factor) over a frequency
range of 1.0GHz to 3.0GHz.

<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/LNA/before_optim.png" alt="Initial S-parameters" width="700"/>

From the intital simulation results we can spot the following:

- **Gain (S21):** The gain was 13.087 dB at 1.4 GHz but dropped to 11.646 dB at 1.84 GHz. Within the target range of 1.4 GHz to 1.8 GHz, the gain decreases linearly from 13.087 dB to approximately 11.8 dB (estimated at 1.8 GHz), falling below the 12 dB target near the upper end of the band. This indicates the need for better gain flatness through output matching optimization.

- **Input Return Loss (S11):** S11 was −13.087 dB at 1.4 GHz and −11.646 dB at 1.84 GHz, remaining ≤ −10 dB across the band. This meets the specification, but the input matching could be further optimized to reduce the noise figure.

- **Output Return Loss (S22):** S22 was poor at 1.4 GHz (−5 dB), failing the ≤ −10 dB goal. It improved to −16 dB at 1.84 GHz, but within 1.4 GHz to 1.8 GHz, S22 ranges from −5 dB to around −14 dB (estimated at 1.8 GHz), failing the goal at the lower end of the band. This highlights the need for output matching network optimization.

- **Stability (SP STBFACT):** The stability factor ranged from 0.75 to 1.15 across 1.0 GHz to 3.0 GHz. Within 1.4 GHz to 1.8 GHz, it was approximately 0.85 to 0.95, indicating potential instability (K < 1). This necessitates adjustments to the matching networks to ensure unconditional stability.

- **Noise Figure:** Not shown in this plot, but later results indicate the initial noise figure was around 5 dB, well above the 2 dB target. This is likely due to the input matching not being optimized for the minimum noise figure (\\(\Gamma_s \\) = \\(\Gamma_{opt} \\)).

These initial results demonstrated the need for optimization, particularly in the output matching network (to improve S22 and gain flatness), input matching (to reduce the noise figure), and overall design (to ensure stability).


---

## Optimization Setup

The optimization framework was set up in ADS using the Optimization Cockpit, as shown in below figure. Seven goals were defined to target the following performance metrics:

- **Gain Flatness Across the Band:** S21 ≥ 12 dB from 1.4 GHz to 1.8 GHz (OptimGoal4 and OptimGoal6), ensuring the gain remains above the target with minimal variation.  
- **Input/Output Matching:** S11 ≤ −10 dB (OptimGoal1) and S22 ≤ −10 dB (OptimGoal2 and OptimGoal7), ensuring good impedance matching at both ports.  
- **Noise Figure Minimization:** Noise figure ≤ 2 dB (OptimGoal3), aiming to reduce the noise figure by optimizing the input matching network.  
- **Stability Assurance:** SP STBFACT ≥ 1 (OptimGoal5), ensuring unconditional stability across the band.  


<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/LNA/whole_setup_for_optimization.png" alt="Optimization setup with design goals" width="700"/>

The optimization variables included the lengths (TL1 L to TL6 L) and widths (w11 to w23) of the microstrip lines, allowing the matching networks to be tuned for optimal performance. A gradient-based optimization algorithm was used, as indicated by the “Gradient” status in the cockpit.


### Optimization Process

The optimization was set up to:
- Minimize noise figure (\\( \leq  {2}{\text{dB}} \\)).
- Maximize gain (\\( S_{21} \geq  {12}{\text{dB}} \\)).
- Maximize return loss (\\( S_{11}, S_{22} \leq  {-10}{\text{dB}} \\)).
- Ensure stability (SP_STBFACT \\( \geq 1 \\)).

<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/LNA/optimization_cockpit.png" alt="Optimization progress and parameters" width="700"/>

After 77 iterations, the final dimensions obtained are:

| Parameter | Value |
|-----------|-------|
| TL1_L     | \\(  {12.2639}{\text{mm}} \\) |
| TL2_L     | \\(  {19.3972}{\text{mm}} \\) |
| TL3_L     | \\(  {39.9198}{\text{mm}} \\) |
| TL4_L     | \\(  {21.4411}{\text{mm}} \\) |
| TL5_L     | \\(  {39.9996}{\text{mm}} \\) |
| TL6_L     | \\(  {35.01}{\text{mm}} \\) |
| w11       | \\(  {2.8233}{\text{mm}} \\) |
| w12       | \\(  {2.9659}{\text{mm}} \\) |
| w13       | \\(  {0.21191}{\text{mm}} \\) |
| w21       | \\(  {0.79796}{\text{mm}} \\) |
| w22       | \\(  {3.47089}{\text{mm}} \\) |
| w23       | \\(  {3.99437}{\text{mm}} \\) |

The optimization process proceeded in two main iterations:

1. **First Iteration:** Focused on improving gain, S22, and noise figure. The results after this iteration showed:  
   - Gain: 14.275 dB to 12.542 dB, meeting the goal.  
   - S11: −10.099 dB to −10.376 dB, meeting the goal.  
   - S22: −12.518 dB to −10.318 dB, meeting the goal.  
   - Noise Figure: Reduced to 2.6 dB, still above the target.  
   - Stability: SP STBFACT remained below 1 (0.85 to 0.95).  

2. **Second Iteration:** Further optimized the noise figure and stability, leading to the final results shown in the subsequent sections.  

The error history plot in the cockpit shows a decreasing trend, with the largest contributions to the error coming from the noise figure (OptimGoal3) and stability (OptimGoal5) goals, indicating these were the hardest to meet.  

The optimization involved trade-offs, such as:  
- Improving the noise figure by adjusting the input matching network (TL4, TL5) to move \\(\Gamma_s \\) closer to \\(\Gamma_{opt} \\), which slightly degraded S11 (from −13.087 dB to −10.245 dB at 1.4 GHz).  
- Enhancing stability by tuning the output matching network (TL2, TL3), which slightly reduced the gain margin at 1.8 GHz (from 12.542 dB to 12.562 dB).


---

## Stability Analysis

The stability factor \\( K \\) is defined as:

$$
K = \frac{1 - |S_{11}|^2 - |S_{22}|^2 + |\Delta|^2}{2|S_{12}S_{21}|}
$$

where:
- \\( \Delta = S_{11}S_{22} - S_{12}S_{21} \\).

For unconditional stability, \\( K > 1 \\) and \\( |\Delta| < 1 \\) must hold across the frequency band. In ADS, the stability factor is approximated by SP STBFACT, which is equivalent to K for most practical purposes. The final stability factor is shown in Figure 5, which corresponds to the SP STBFACT plot from the final simulation results.


<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/LNA/stability_factor.png" alt="Stability factor verification" width="700"/>

From the above stability factor plot vs frequency we can see that: at 1.6 GHz, SP STBFACT = 1.003, indicating unconditional stability at this frequency. Across 1.4 GHz to 1.8 GHz, SP STBFACT ranges from approximately 0.95 to 1.05 (visually estimated). It is slightly below 1 at the edges of the band, meaning the amplifier is not unconditionally stable across the entire range but is very close. The initial design had SP STBFACT ranging from 0.85 to 0.95, indicating potential instability. The optimization process improved this by adjusting the matching networks to reduce the magnitudes of S11 and S22, thereby increasing K. The final value of 1.003 at 1.6 GHz suggests the design is stable at the center frequency, but further optimization (e.g., adding a series resistor or adjusting the matching networks) could ensure K > 1 across the entire band.


---

## Input Matching
 The input return loss (S11) performance is shown in the below Figure, which corresponds to the S11 plot from the
 final simulation results
 
<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/LNA/input_matching_results.png" alt="Input matching network S-parameters" width="700"/>

The input matching network (TL4, TL5) was optimized to achieve this performance. However, a trade-off was made to reduce the noise figure: the input impedance was adjusted to move \\( \Gamma_s \\) closer to \\( \Gamma_{\text{opt}} \\) for minimum noise figure, which slightly degraded \\( S_{11} \\) from the initial −13.087 dB to −10.245 dB at 1.4 GHz. This trade-off is acceptable since \\( S_{11} \\) still meets the goal, and the noise figure was reduced from 5 dB to 1.996 dB at 1.8 GHz.


---

## Output Matching

<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/LNA/output_matching_network_s_par.png" alt="Output matching network S-parameters" width="700"/>

The output matching network (TL2, TL3) was significantly improved during optimization. The initial design had a poor \\( S_{22} \\) of −5 dB at 1.4 GHz, which was corrected to −12.518 dB after the first optimization and further refined to −12.255 dB in the final design. This improvement ensures maximum power transfer to the 50 Ω load and contributes to the overall gain flatness.


---

## Gain Performance

<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/LNA/after_optim.png" alt="Final S-parameters after optimization" width="700"/>
The results shows that

- **At 1.4 GHz:**  
  \\( S_{21} = 14.262 \, \text{dB} \\) (marker **m1**)

- **At 1.8 GHz:**  
  \\( S_{21} = 12.562 \, \text{dB} \\) (marker **m2**)

- **Across 1.4 GHz to 1.8 GHz:**  
  \\( S_{21} \\) ranges from **14.262 dB** to **12.562 dB**, consistently **≥ 12 dB**, meeting the specification.

---

**Gain Flatness:**  
$$
14.262 \, \text{dB} - 12.562 \, \text{dB} = 1.7 \, \text{dB}
$$  
This is reasonable for an **LNA** in this frequency range.

---

The initial design had a gain that dropped below **12 dB** near **1.8 GHz** (~11.8 dB estimated), but the **optimization process** improved the **output matching** and **bias network**, resulting in a gain that exceeds the target across the band.

**Average Gain:**  
\\[
\frac{14.262 \, \text{dB} + 12.562 \, \text{dB}}{2} \approx 13.4 \, \text{dB}
\\]  
This provides a **good margin above the 12 dB requirement**.

---

## Noise Performance

<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/LNA/noise_figure.png" alt="Noise figure performance" width="700"/>

The noise figure goal is ≤ 2 dB across the band. The final design achieves **1.996 dB** at 1.8 GHz, which meets the goal at that frequency, but it is slightly above 2 dB at 1.6 GHz (**2.091 dB**) and likely around **2.1 dB** at 1.4 GHz. Therefore, the noise figure does not fully meet the specification across the entire band. The initial noise figure was around **5 dB**, which was reduced to **2.6 dB** after the first optimization and further to **1.996–2.091 dB** in the final design. This improvement was achieved by optimizing the input matching network to move \\( \Gamma_s \\) closer to \\( \Gamma_{\text{opt}} \\), but the transistor’s \\( F_{\min} \\) and substrate losses (\\( \tan \delta = 0.02 \\)) limit further reduction without changing the design (e.g., using a lower-noise transistor or a better substrate).


---

## Final Results

- Frequency range: \\(  {1.4}{\text{GHz}} \\)–\\(  {1.8}{\text{GHz}} \\)
- \\( S_{21} \geq  {12}{\text{dB}} \\)
- \\( S_{11}, S_{22} \leq  {-10}{\text{dB}} \\)
- Noise figure \\( \approx  {2}{\text{dB}} \\)
- Stability factor \\( K \approx 1 \\) at \\(  {1.6}{\text{GHz}} \\)

**Comparison Table:**

| Parameter | Specification | Simulation Result |
|-----------|---------------|-------------------|
| Frequency (GHz) | 1.4–1.8 | 1.4–1.8 |
| \\( S_{21} \\) at 1.4 GHz (dB) | ≥ 12 | 14.262 |
| \\( S_{21} \\) at 1.8 GHz (dB) | ≥ 12 | 12.562 |
| \\( S_{11} \\) in Band (dB) | ≤ -10 | -10.245 to -11.253 |
| \\( S_{22} \\) in Band (dB) | ≤ -10 | -12.255 to -11.801 |
| Noise Figure (dB) | ≤ 2 | 1.996–2.091 |
| Stability Factor (K) | > 1 | 0.95–1.05 |

---

## Conclusion

 The designed LNA meets most of the specifications, with some areas for improvements.
 
---
