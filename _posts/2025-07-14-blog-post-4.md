---
title: "Simulation of Differential-Mode Gilbert Cell Mixer Using ADS"
date: 2024-09-07
permalink: /posts/2025/09/gilbert-mixer/
tags:
  - RFIC
  - Microwave Engineering
  - ADS
  - Mixer
---

## Design Objective

The goal is to simulate a **differential-mode Gilbert cell mixer** with differential inputs and outputs. The RF frequency is 900 MHz, LO frequency is 850 MHz, resulting in an IF of 50 MHz. Small-signal mixer mode is used for quick calculation of conversion gain, assuming the RF signal is small enough to not drive the mixer into compression. A noise figure simulation is also included.

The simulation demonstrates key performance metrics like conversion gain and noise figure as functions of LO power.

---

## Mixer Design and Theory

The mixer is a **differential Gilbert cell design**, widely used in RFIC for its balanced operation, good linearity, and port isolation. The Gilbert cell consists of a transconductance stage (differential RF input pair) and a switching stage (cross-coupled LO pairs), with a load for IF output.

The conversion gain \\( G_c \\) for a Gilbert cell mixer under small-signal conditions is approximately:

$$
G_c = \frac{2}{\pi} g_m R_L
$$

where:
- \\( g_m \\) = transconductance of the RF input transistors
- \\( R_L \\) = load resistance

The noise figure \\( NF \\) can be modeled as:

$$
NF = 10 \log_{10} \left( 1 + \gamma + \frac{\pi^2}{8} \frac{1}{g_m R_L} \right)
$$

where \\( \gamma \\) is the excess noise factor of the BJT (typically 2/3 for ideal BJT).

The LO switching ideally follows a square wave, but in practice, it's sinusoidal, leading to the \\( 2/\pi \\) factor from the Fourier series of the switching function.

The input-referred noise voltage includes contributions from thermal noise of resistors and shot noise of BJTs:

$$
v_{n,\text{thermal}} = \sqrt{4 k T R \Delta f}
$$

$$
i_{n,\text{shot}} = \sqrt{2 q I \Delta f}
$$

where:
- \\( k \\) = Boltzmann constant
- \\( T \\) = temperature
- \\( R \\) = resistance
- \\( \Delta f \\) = bandwidth
- \\( q \\) = electron charge
- \\( I \\) = current

Harmonic balance (HB) simulation is used for steady-state analysis, solving:

$$
\mathbf{I}(\mathbf{V}) + j \omega \mathbf{Q}(\mathbf{V}) = \mathbf{0}
$$

where \\( \mathbf{I} \\) and \\( \mathbf{Q} \\) are nonlinear current and charge functions, \\( \mathbf{V} \\) is voltage vector.

Small-signal mixer mode assumes linear response around the LO-driven operating point.

---

## Schematic Design

The mixer schematic features differential LO and RF inputs using Balun4Port components, BJT transistors, and differential IF output.

<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/DIFFMODEMIX/shcem.png" alt="Full Gilbert Cell Mixer Schematic" width="700"/>

The LO Input and RF Input sections:

<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/DIFFMODEMIX/diff_input.png" alt="LO and RF Input Schematic" width="700"/>

- LO Input: Balun4Port CMP3, P_1Tone Freq=LOFreq (850 MHz), Power=LO_power (-40 to -10 dBm), V_DC=5V.
- RF Input: Balun4Port CMP1, P_1Tone Freq=RF_Freq (900 MHz), Power=RF_power (-60 dBm), V_DC=1.5V.

The IF Output section:

<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/DIFFMODEMIX/diff_output.png" alt="IF Output Schematic" width="700"/>

- Balun4Port CMP2, capacitors C1=100 pF, C2=100 pF, resistor R16=1000 Ohm, Term3 Z=2000 Ohm.

The core mixer includes multiple BJT NPN transistors (e.g., BJT1 to BJT14) in differential pairs and cross-coupled configuration, with resistors R1 to R14 for biasing and matching.

---

## Simulation Setup

The Harmonic Balance (HB) simulation and the other simulation parameters are shown in the below figure.

<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/DIFFMODEMIX/sim_params.png" alt="Simulation parameters" width="700"/>

HB Settings:
- Freq[1]=LOFreq (850 MHz)
- Order[1]=5
- SS_Mixer=yes
- UseAllSS_Freqs=yes
- InputFreq=RF_power
- FreqForNoise=IF Freq (50 MHz)
- NoiseNode[1]=Vifd
- SortNoise=Sort by value
- SweepVar="LO_power", Start=-40, Stop=-10, Step=5
- OtherOutVar="RF_power"

The simulation sweeps LO power to evaluate conversion gain and noise figure.

---

## Simulation Results

The results show conversion gain and noise figure versus LO power.

<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/DIFFMODEMIX/res1.png" alt="Conversion Gain and Noise Figure vs LO Power" width="700"/>

- Conversion Gain: Increases from ~4 dB at LO=-40 dBm to ~13 dB at LO=-10 dBm, saturating at higher LO power.
- Noise Figure: Decreases from ~18 dB at LO=-40 dBm to ~14 dB at LO=-10 dBm, indicating better performance at higher LO power.

Noise contributors at LO=-40 dBm, noisefreq=50 MHz:

<img src="https://abdelrahman-dip.github.io/abdelrahmanosman.github.io/images/DIFFMODEMIX/res2.png" alt="Noise Contributors Table" width="700"/>

- Total: 30.96 nV
- Top contributors: BJT1 Rb (11.18 nV), BJT1.ice (7.836 nV), BJT2 Rb (7.836 nV), BJT2.ice (7.701 nV), etc., showing BJT thermal and shot noise dominate.

---

## Final Results

- RF Frequency: 900 MHz
- LO Frequency: 850 MHz
- IF Frequency: 50 MHz
- Conversion Gain: Up to 13 dB at LO=-10 dBm
- Noise Figure: Down to 14 dB at LO=-10 dBm

**Comparison Table:**

| Parameter | Value at LO=-40 dBm | Value at LO=-10 dBm |
|-----------|---------------------|---------------------|
| Conversion Gain (dB) | ~4 | ~13 |
| Noise Figure (dB) | ~18 | ~14 |

The small-signal mode provides quick insights, but for large RF signals, full nonlinear HB would be needed to assess compression.

---

## Conclusion

The simulation of the differential mode Gilbert cell mixer in ADS demonstrates a good conversion gain and noise performance, with BJT noise sources as primary contributors. it highlights the utility of small-signal mixer mode for RFIC designers analyzing differential circuits.

---
